<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Etik Social</title>

<script type="module" src="firebase.js"></script>

<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: radial-gradient(circle at top, #1f3c46, #0b1417);
  font-family: system-ui;
}

.card {
  width: 320px;
  background: #0f0f0f;
  padding: 22px;
  border-radius: 18px;
}

h2 {
  text-align: center;
  margin-bottom: 18px;
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: none;
  background: #1e1e1e;
  color: #fff;
}

button {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  background: #4f9cff;
  color: white;
  font-weight: 600;
  cursor: pointer;
}

.msg {
  text-align: center;
  margin-bottom: 10px;
  font-size: 14px;
}

.success { color: #4caf50; }
.error { color: #ff4c4c; }

.switch {
  text-align: center;
  margin-top: 12px;
  font-size: 14px;
  color: #aaa;
}

.switch span {
  color: #4f9cff;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="card">
  <h2 id="title">GiriÅŸ Yap</h2>

  <input id="displayName" placeholder="GÃ¶rÃ¼nen isim" style="display:none">
  <input id="emoji" placeholder="Emoji ðŸ˜ŽðŸ”¥" style="display:none">

  <input id="username" placeholder="Ä°sim etiketi (@eyup)">
  <input id="password" type="password" placeholder="Åžifre">

  <div id="msg" class="msg"></div>

  <button onclick="action()">Devam Et</button>

  <div class="switch">
    <span id="switchText" onclick="toggle()">HesabÄ±n yok mu? KayÄ±t ol</span>
  </div>
</div>

<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

let mode = "login";

window.toggle = () => {
  mode = mode === "login" ? "register" : "login";
  document.getElementById("title").innerText = mode === "login" ? "GiriÅŸ Yap" : "KayÄ±t Ol";
  document.getElementById("displayName").style.display = mode === "register" ? "block" : "none";
  document.getElementById("emoji").style.display = mode === "register" ? "block" : "none";
  document.getElementById("switchText").innerText =
    mode === "login" ? "HesabÄ±n yok mu? KayÄ±t ol" : "Zaten hesabÄ±n var mÄ±? GiriÅŸ yap";
};

window.action = async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const displayName = document.getElementById("displayName").value.trim();
  const emoji = document.getElementById("emoji").value.trim();
  const msg = document.getElementById("msg");

  msg.innerText = "";
  msg.className = "msg";

  if (!username || !password) {
    msg.innerText = "BoÅŸ alan bÄ±rakma";
    msg.classList.add("error");
    return;
  }

  const ref = doc(db, "users", username);
  const snap = await getDoc(ref);

  if (mode === "register") {
    if (snap.exists()) {
      msg.innerText = "Bu kullanÄ±cÄ± adÄ± alÄ±nmÄ±ÅŸ";
      msg.classList.add("error");
      return;
    }

    await setDoc(ref, {
      username,
      password,
      displayName,
      emoji
    });

    msg.innerText = "KayÄ±t baÅŸarÄ±lÄ± âœ”";
    msg.classList.add("success");

  } else {
    if (!snap.exists() || snap.data().password !== password) {
      msg.innerText = "KullanÄ±cÄ± adÄ± veya ÅŸifre yanlÄ±ÅŸ";
      msg.classList.add("error");
      return;
    }

    localStorage.setItem("loggedUser", JSON.stringify(snap.data()));
    window.location = "home.html";
  }
};
</script>

</body>
</html>
