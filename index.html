<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Anonim Mesajlar</title>
<style>
  body {
    margin: 0; font-family: Arial, sans-serif;
    min-height: 100vh;
    background: #f0f0f0;
    transition: background 0.5s, color 0.5s;
    color: #222;
    display: flex; justify-content: center; align-items: flex-start;
    padding: 20px;
  }
  .hidden { display: none; }
  .container {
    width: 360px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    padding: 20px;
  }
  h2 {
    margin-top: 0;
  }
  input, textarea, button {
    width: 100%; margin-top: 10px; padding: 10px; border-radius: 6px;
    border: 1px solid #ccc; box-sizing: border-box;
    font-size: 1rem;
  }
  button {
    cursor: pointer; border: none; background: #4caf50; color: white;
    font-weight: bold;
    transition: background 0.3s;
  }
  button:hover { background: #45a049; }

  ul {
    list-style: none; padding: 0; max-height: 300px; overflow-y: auto;
    margin-top: 10px;
    border-top: 1px solid #eee;
  }
  li {
    padding: 8px 5px;
    border-bottom: 1px solid #eee;
    font-size: 0.9rem;
    white-space: pre-wrap;
  }
  .date {
    font-size: 0.7rem;
    color: #999;
  }
  /* Temalar */
  body.hacker { background: #000; color: #0f0; }
  body.hacker .container { background: #020; box-shadow: 0 0 20px #0f0; }
  body.plain { background: #f2f2f2; color: #222; }
  body.plain .container { background: #fff; box-shadow: 0 0 10px rgba(0,0,0,.1); }
  body.flower { background: #fff0f5; color: #444; }
  body.flower .container {
    background: #fff;
    border: 2px dashed #f5a;
  }

  .nav {
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    gap: 5px;
  }
  .nav button {
    flex: 1;
    background: #2196F3;
  }
  .nav button:hover {
    background: #0b7dda;
  }
</style>
</head>
<body>

<div class="container">

  <!-- ƒ∞sim + Tema se√ßimi (ilk a√ßƒ±lƒ±≈üta) -->
  <div id="setup" >
    <h2>Ho≈ügeldin! √ñnce ismini gir:</h2>
    <input type="text" id="nameInput" placeholder="Adƒ±n ne?" />
    <h2>Ardƒ±ndan tema se√ß:</h2>
    <div class="nav">
      <button onclick="selectTheme('hacker')">üß™ Hacker</button>
      <button onclick="selectTheme('plain')">‚ö° Sade</button>
      <button onclick="selectTheme('flower')">üåº √ái√ßekli</button>
    </div>
  </div>

  <!-- Ana Men√º -->
  <div id="mainMenu" class="hidden">
    <h2 id="welcomeMsg"></h2>
    <div class="nav">
      <button onclick="showMessages()">Mesajlar</button>
      <button onclick="showNewMessage()">Yeni Mesaj Yaz</button>
      <button onclick="changeTheme()">Tema Deƒüi≈ütir</button>
      <button onclick="changeName()">ƒ∞sim Deƒüi≈ütir</button>
    </div>
  </div>

  <!-- Mesajlar listesi -->
  <div id="messagesList" class="hidden">
    <h2>Anonim Mesajlar</h2>
    <ul id="messagesUl"></ul>
  </div>

  <!-- Yeni Mesaj Yaz -->
  <div id="newMessage" class="hidden">
    <h2>Yeni Mesaj Yaz</h2>
    <textarea id="msgInput" placeholder="Mesajƒ±nƒ± yaz..."></textarea>
    <button id="sendBtn">G√∂nder</button>
  </div>

</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBSSFp-uB8XQdpCfS5jokwqkbnKBi6oXMc",
    authDomain: "etik-social.firebaseapp.com",
    projectId: "etik-social",
    storageBucket: "etik-social.firebasestorage.app",
    messagingSenderId: "358422049811",
    appId: "1:358422049811:web:dd9506109825aaed65fbe6",
    measurementId: "G-LGYN8FW2J8"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // DOM elemanlarƒ±
  const setup = document.getElementById('setup');
  const mainMenu = document.getElementById('mainMenu');
  const welcomeMsg = document.getElementById('welcomeMsg');
  const messagesList = document.getElementById('messagesList');
  const messagesUl = document.getElementById('messagesUl');
  const newMessage = document.getElementById('newMessage');
  const msgInput = document.getElementById('msgInput');
  const sendBtn = document.getElementById('sendBtn');

  // Kullanƒ±cƒ± bilgileri
  let userName = localStorage.getItem('userName') || '';
  let userTheme = localStorage.getItem('userTheme') || 'plain';

  // Ba≈ülangƒ±√ß fonksiyonu
  function startApp() {
    if(userName && userTheme) {
      applyTheme(userTheme);
      showMainMenu();
    } else {
      showSetup();
    }
  }

  // Tema uygula
  function applyTheme(theme) {
    document.body.className = '';
    document.body.classList.add(theme);
  }

  // Setup g√∂ster
  function showSetup() {
    setup.classList.remove('hidden');
    mainMenu.classList.add('hidden');
    messagesList.classList.add('hidden');
    newMessage.classList.add('hidden');
  }

  // Main men√ºy√º g√∂ster
  function showMainMenu() {
    setup.classList.add('hidden');
    mainMenu.classList.remove('hidden');
    messagesList.classList.add('hidden');
    newMessage.classList.add('hidden');
    welcomeMsg.innerText = `Ho≈ügeldin, ${userName}!`;
  }

  // Mesaj listesi g√∂ster
  function showMessages() {
    setup.classList.add('hidden');
    mainMenu.classList.add('hidden');
    messagesList.classList.remove('hidden');
    newMessage.classList.add('hidden');
    loadMessages();
  }

  // Yeni mesaj ekranƒ± g√∂ster
  function showNewMessage() {
    setup.classList.add('hidden');
    mainMenu.classList.add('hidden');
    messagesList.classList.add('hidden');
    newMessage.classList.remove('hidden');
    msgInput.value = '';
  }

  // Tema se√ßimi fonksiyonu
  window.selectTheme = function(theme) {
    userTheme = theme;
    localStorage.setItem('userTheme', theme);
    applyTheme(theme);
    if(userName.length < 2) {
      alert('√ñnce ismini gir!');
      showSetup();
      return;
    }
    showMainMenu();
  };

  // ƒ∞sim deƒüi≈ütirme fonksiyonu
  window.changeName = function() {
    userName = prompt('Yeni ismini gir:', userName);
    if(userName && userName.trim().length >= 2) {
      userName = userName.trim();
      localStorage.setItem('userName', userName);
      welcomeMsg.innerText = `Ho≈ügeldin, ${userName}!`;
      alert('ƒ∞sim g√ºncellendi!');
    } else {
      alert('Ge√ßerli isim girilmedi.');
    }
  };

  // Tema deƒüi≈ütirme fonksiyonu
  window.changeTheme = function() {
    alert('Tema deƒüi≈ütirmek i√ßin sayfayƒ± yenileyip tekrar tema se√ßmelisin.'); 
  };

  // Mesaj g√∂nderme
  sendBtn.onclick = async () => {
    const text = msgInput.value.trim();
    if(text.length < 2) {
      alert('L√ºtfen ge√ßerli bir mesaj yaz.');
      return;
    }
    try {
      await addDoc(collection(db, 'messages'), {
        name: userName,
        message: text,
        timestamp: serverTimestamp()
      });
      alert('Mesaj g√∂nderildi!');
      msgInput.value = '';
      showMessages();
    } catch(e) {
      alert('Mesaj g√∂nderilirken hata olu≈ütu: ' + e.message);
    }
  };

  // Mesajlarƒ± y√ºkle ve listele (realtime)
  function loadMessages() {
    messagesUl.innerHTML = '<li>Y√ºkleniyor...</li>';
    const q = query(collection(db, 'messages'), orderBy('timestamp', 'desc'));
    onSnapshot(q, (snapshot) => {
      messagesUl.innerHTML = '';
      if(snapshot.empty) {
        messagesUl.innerHTML = '<li>Hen√ºz mesaj yok.</li>';
        return;
      }
      snapshot.forEach(doc => {
        const data = doc.data();
        const date = data.timestamp?.toDate();
        const dateStr = date ? date.toLocaleString() : '...';
        const li = document.createElement('li');
        li.innerHTML = `<strong>${data.name}</strong>: ${data.message}<br><span class="date">${dateStr}</span>`;
        messagesUl.appendChild(li);
      });
    });
  }

  // Ba≈ülat
  window.onload = startApp;
</script>

</body>
</html>
